import gpflow
from abc import ABC, abstractmethod
import textwrap

from src.models.paper_1.deaths.vulnerability.ada.abc.models_deaths_vulnerability_ada_abc_processing import (
    AbstractBaseModels_Deaths_Vulnerability_ADA_Processing)

# GPFlux_ArchitectureBuilder_1, AbstractGPFlux_ArchitectureBuilder
from src.ai.gp_family.kernel_utils import (GPFlow_KernelBuilder, GPFlow_GPR_EquationBuilder,
                                           )

from src.models.paper_1.deaths.vulnerability.ada.models_deaths_vulnerability_ada_variables import (Model_V1)


class AbstractModels_GPR_Deaths_Vulnerability_ADA_Processing(AbstractBaseModels_Deaths_Vulnerability_ADA_Processing,
                                                             ABC):

    @property
    def _model_algorithm(self) -> str:
        return "GP"

    @property
    def _model_scope(self) -> str:
        return "vulnerability"

    @property
    def _model_vulnerability(self) -> str:
        return "deaths"

    @property
    def gpr_equation_builder(self) -> GPFlow_GPR_EquationBuilder:
        return self._gpr_equation_builder

    @property
    @abstractmethod
    def _gpr_equation_builder(self) -> GPFlow_GPR_EquationBuilder:
        raise NotImplementedError

    @property
    def _plot_title_suffix(self):
        return f"x_variables : {textwrap.fill(str(self.x_variables), 120)} \n " \
               f"kernel: {textwrap.fill(self.gpr_equation_builder.kernel_metadata, 120)}"


# class AbstractModels_DeepGPR_Deaths_Vulnerability_ADA_Processing(AbstractBaseModels_Deaths_Vulnerability_ADA_Processing,
#                                                                  ABC):
#
#     @property
#     def _model_algorithm(self) -> str:
#         return "DeepGP"
#
#     @property
#     def _model_vulnerability(self) -> str:
#         return "deaths"
#
#     @property
#     def architecture_builder(self) -> AbstractGPFlux_ArchitectureBuilder:
#         return self._architecture_builder
#
#     @property
#     @abstractmethod
#     def _architecture_builder(self) -> AbstractGPFlux_ArchitectureBuilder:
#         raise NotImplementedError
#
#     @property
#     def _plot_title_suffix(self):
#         return f"x_variables : {textwrap.fill(str(self.x_variables), 120)} \n " \
#                f"kernels: {textwrap.fill(self.architecture_builder.kernels_metadata, 120)}"


class Model_GPR_Deaths_Vulnerability_ADA_Processing_F1_M1_V1(AbstractModels_GPR_Deaths_Vulnerability_ADA_Processing):
    _x_variables = Model_V1.x_variables
    _y_variable = Model_V1.y_variable
    _rename_variables_dict = Model_V1.rename_variables_dict

    _kernel_dict = {'k1': gpflow.kernels.RBF(active_dims=[0, 1, 2, 3, 4, 5, 6])}
    _kernel_key_equation = 'k1'

    @property
    def _gpr_equation_builder(self) -> GPFlow_GPR_EquationBuilder:
        k1 = GPFlow_KernelBuilder(key='k1', gpflow_kernel=gpflow.kernels.RBF())

        return GPFlow_GPR_EquationBuilder(kernel_builder_list=[k1],
                                          kernel_builder_key_equation=f"{k1.key}",
                                          x_variables=self._x_variables,
                                          y_variable=self._y_variable)


# class Model_DeepGPR_Deaths_Vulnerability_ADA_Processing_A_1(AbstractModels_DeepGPR_Deaths_Vulnerability_ADA_Processing):
#     _x_variables = Model_V1.x_variables
#     _y_variable = Model_V1.y_variable
#     _rename_variables_dict = Model_V1.rename_variables_dict
#
#     _kernels_dict = {'layer_1': {'k1': gpflow.kernels.RBF()},
#                      'last_layer': {'k1': gpflow.kernels.RBF()}}
#     _kernels_key_equation = {'layer_1': 'k1',
#                              'last_layer': 'k1'}
#
#     _likelihood = gpflow.likelihoods.Gaussian()
#
#     @property
#     def _architecture_builder(self) -> AbstractGPFlux_ArchitectureBuilder:
#         input_kernel = GPFlow_KernelBuilder(key='ik1', gpflow_kernel=gpflow.kernels.RBF())
#         input_kernel_equation = GPFlow_GPR_EquationBuilder(
#             kernel_builder_list=[input_kernel],
#             kernel_builder_key_equation=f"{input_kernel.key}",
#             x_variables=self._x_variables,
#             y_variable=self._y_variable)
#
#         output_kernel_1 = GPFlow_KernelBuilder(key='ok1', gpflow_kernel=gpflow.kernels.RBF())
#         output_kernel_equation = GPFlow_GPR_EquationBuilder(
#             kernel_builder_list=[output_kernel_1],
#             kernel_builder_key_equation=f"{output_kernel_1.key}",
#             x_variables=self._x_variables,
#             y_variable=self._y_variable)
#
#         return GPFlux_ArchitectureBuilder_1(input_layer_kernel=input_kernel_equation,
#                                             output_layer_kernel=output_kernel_equation,
#                                             likelihood=gpflow.likelihoods.Gaussian(),
#                                             x_variables=self._x_variables,
#                                             y_variable=self._y_variable)
